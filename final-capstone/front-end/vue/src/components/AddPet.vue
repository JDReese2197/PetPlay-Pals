<template>
<div id="register">
    <form v-on:submit.prevent>
        <div class="field">
            <label for="name">Name</label>
            <input 
                type="text" 
                name="name" 
                placeholder="Name"
                v-model="pet.petName"
                required
            />
        </div>
        <div class="field">
            <label for="age">Age</label>
            <input 
                type="number" 
                name="age" 
                placeholder="Age"
                v-model="pet.age"
            />
        </div>
        <div class="field">
            <label for="name">Type</label>
            <select id="type" name="type" placeholder="Type" v-model="pet.petType" required>
                <option value="dog">Dog</option>
                <option value="cat">Cat</option>
                <option value="bird">Bird</option>
                <option value="reptile">Reptile</option>
                <option value="other">Other</option>
            </select>
        </div>
         <div class="field">
            <label for="breed">Breed</label>
            <input 
                type="text" 
                name="breed" 
                placeholder="Breed"
                v-model="pet.breed"
            />
        </div>
        <div class="field">
            <label for="size">Size</label>
            <input 
                type="text" 
                name="size" 
                placeholder="Size"
                v-model="pet.size"
            />
        </div>
        <div class="field">
            <label for="gender">Gender</label>
            <input 
                type="text" 
                name="gender" 
                placeholder="Gender"
                v-model="pet.gender"
            />
        </div>
        <div class="field">
            <label for="name">Personality</label>
            <select id="personality" name="personality" placeholder="Personality" v-model="pet.personalityType" required>
                <option value="" disabled selected hidden>Personality</option>
                <option value="shy">Shy, Timid</option>
                <option value="friendly">Friendly, Sweet</option>
                <option value="loving">Loving, Affectionate</option> 
                <option value="curious">Curious, Adventurous</option>
                <option value="gentle">Gentle, Laidback</option>
                <option value="active">Active, Playful</option>
                <option value="confident">Confident, String-Willed</option>
            </select>
        </div>
        <div class="field">
            <label for="bio">Bio</label>
            <input 
                type="text"
                name="bio" 
                placeholder="Bio"
                v-model="pet.description"
            />
        </div>
        <div class="actions">
            <button type="submit" v-on:click="submitPetForm">Submit</button>
        </div>
    </form>
</div>
</template>

<script>
import applicationServices from "@/services/ApplicationServices";

export default {
    name: "add-pet",
    created() {
        this.setProfileId();
        this.setPetId();
    },
    data() {
        return {
            selectedFile: null,
            pet: {
                petId: null,
                profileId: null,
                petName: "",
                age: "",
                petType: "",
                breed: "",
                size:"",
                gender: "",
                personalityType: "",
                description: ""
            },
            errorMessage: ""
        };
    },
    methods: {
        setProfileId() {
            this.pet.profileId = this.$store.state.profile.profileId;
        },
        setPetId() {
            if (this.$store.state.pet.petId != null) {
                this.pet.petId = this.$store.state.pet.petId;
            }
            else {
                this.pet.petId = 0;
            }
        },
        submitPetForm() {
            const newPet = this.pet;
            if (this.pet.petId === 0) {
                applicationServices
                    .addPet(newPet)
                    .then(response => {
                        if(response.status === 200) {
                            this.$store.commit("SET_PET", response.data);
                            this.$router.push(`/profile/${this.$store.state.profile.profileId}`);
                        }
                    })
                    .catch(error => {
                        this.handleErrorResponse(error, "updating");
                    });
            }
        },
        handleErrorResponse(error, verb) {
            if (error.response) {  
            this.errorMsg =                                     
                "Error " + verb + " card. Response received was '" + 
                error.response.statusText +                   
                "'.";                                            
            } else if (error.request) {     
                this.errorMsg =                                         
                "Error " + verb + " card. Server could not be reached.";  
            } else {                       
                this.errorMsg =                                            
                "Error " + verb + " card. Request could not be created."; 
            }
        }
    },
    computed: {
        profile() {
            return this.$store.state.profile;
        },
    }
}
</script>

<style scoped>
#register {
    font-family: Arial, Helvetica, sans-serif;
    display: grid;
    grid-template-columns: 1fr 1fr 1fr; 
    grid-template-areas: 
        ". form .";
}
form {
    grid-area: form;
    line-height: 20px;
}
input {
    width: 100%;
    padding: 10px 10px;
    margin: 8px 0;
    box-sizing: border-box;
    font-size: 15px;
    color: #555555;
}
.field {
    margin: 5px 0;
}
label {
    font-weight: bold;
    color: #555555;
}
select {
    width: 100%;
    padding: 10px 10px;
    margin: 8px 0;
    box-sizing: border-box;
    font-size: 15px;
    color: #555555;
}
button {
    border: none;
    border-radius: 20px;
    text-transform: uppercase;
    background-color: #29d2db;
    color: white;
    font-size: 20px;
    padding: 5px 15px;
}
</style>